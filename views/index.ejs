<!DOCTYPE HTML>
<html lang="en">
	<head>
		<title>Soncoya - The Future of Cooking!</title>
		<link rel="stylesheet" href="master.css" type="text/css">
		
		<script src="/nowjs/now.js"></script>
		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script> 
		
		<!-- include the hashing stuff -->
		<script type="text/javascript" src="jshash/sha1.js"></script>
		
		<!-- include the cookie stuff -->
		<script type="text/javascript" src="jquery.cookie.js"></script>
		
		<script type = "text/javascript">
			$(document).ready(function() {
				
				var currentPage = 1;
			
				now.appendRecipe = function (recipe) {
					var div = $("#recipelistdiv");
					var recipeId = recipe.recipeId;
					div.append("<div id=\"recipe"+recipeId+"\" class=\"recipeBox\"></div>");
					var title = recipe.title;
					var author = recipe.submitter;
					var price = recipe.cost;
					var rating = recipe.rating;
					var newdiv = $("#recipe"+recipeId);
					var infodiv = $("<div>");
					var titlediv = $("<div>");
					var etcdiv = $("<div>");
					var imgdiv = $("<div>");
					infodiv.addClass("recipeInfo");
					titlediv.addClass("recipeTitle");
					etcdiv.addClass("recipeEtc");
					imgdiv.addClass("recipeImg");
					
					newdiv.append(infodiv);
					infodiv.append(titlediv);
					infodiv.append(etcdiv);
					newdiv.append(imgdiv);
					
					titlediv.append(title);
					etcdiv.append("By: " + author + " | Price: $" + price + " | Rating: " + rating + "/5");
					imgdiv.append("<img src='http://placekitten.com/100/100'></div>");
					div.animate({ scrollTop: div.attr("scrollHeight") }, 500);		
				};
				
				now.clearRecipeList = function () {
					$("#recipelistdiv").html("");
				}
				
				now.refreshRecipeList = function (search, page) {
					now.clearRecipeList();
					$('#currentpage').text(page);
					now.getRecipeList(search, page);
				}
				
				$("#refreshRecipeList").click(function () {
					now.refreshRecipeList("", currentPage);
				});
				
				$('#refreshRecipeListT').click(function () {
					now.refreshRecipeList("Apple", 1);
				});
				
				$('#filter').keyup(function () {
					now.refreshRecipeList($(this).val(), 1);
				});
				
				$('#refreshRecipeListP').click(function () {
					now.refreshRecipeList("Potato", 1);
				});
				
				$('#prevpage').click(function () {
					now.tryMoveBack($("#filter").val(), $("#currentpage").text());
					//currentPage = currentPage - 1;
					//now.refreshRecipeList("", currentPage);
				});
				
				$('#nextpage').click(function () {
					now.tryMoveForward($("#filter").val(), $("#currentpage").text());
					//currentPage = currentPage + 1;
					//now.refreshRecipeList("", currentPage);
				});
				
				$("#exampleRecipe").click(function() {
					now.addRecipe("DERP SOUP", "13", [{item:"muffins", "quantity-us":"2", "quantity-metric":"3", "measure-us":"lbs", "measure-metric":"tons"}, {item:"potatoes", "quantity-us":"2", "quantity-metric":"3", "measure-us":"lbs", "measure-metric":"tons"}], ["herp", "derp", "done"], "http://placekitten.com/100/100", "Derpy Whooves", "9000", ["potatoes", "potato", "muffin", "muffins"], parseInt(("" + Math.random()).substring(2)), $('#filter').val());
				});
				
				$("#exampleRecipe1").click(function() {
					now.addRecipe("TOMATO SOUP", "13", [{item:"muffins", "quantity-us":"2", "quantity-metric":"3", "measure-us":"lbs", "measure-metric":"tons"}, {item:"potatoes", "quantity-us":"2", "quantity-metric":"3", "measure-us":"lbs", "measure-metric":"tons"}], ["herp", "derp", "done"], "http://placekitten.com/100/100", "Derpy Whooves", "9000", ["tomatoes", "tomato", "apple", "apple"], parseInt(("" + Math.random()).substring(2)), $('#filter').val());
				});
				
				$("#registersubmit").click(function() {
					if ($('#unamereg').val() == "" | $('#pwdreg').val() == "") {
						alert("Please don't input blanks");
					} else {
						now.tryRegister($('#unamereg').val(), b64_sha1($('#pwdreg').val()));
					}
				});
				
				$("#loginsubmit").click(function() {
					now.tryLogin($('#unamelogin').val(), b64_sha1($('#pwdlogin').val()));
				});
				
				now.reRegisterAlert = function() {
					alert("Username is already taken. Sadface.");
				};
				
				now.reLoginAlert = function() {
					alert("Username or password incorrect.");
				}
				
				now.cleanLogin = function(uname, pwd) {
					$('#logindiv').slideUp(200);
					$('#unamelogin').val("");
					$('#pwdlogin').val("");
					$('#headertext').html("<a href='#' onclick='now.tryLogout()'>Logout</a>");
					
					//set cookie here
					$.cookie('username', uname);
					$.cookie('pwd', pwd);
					now.setCookie(uname, pwd);
				}
				
				//Cleans register div and removes it. Also replaces REGISTER - SIGNIN with just LOGOUT.
				now.cleanRegister = function(uname, pwd) {
					$('#registerdiv').slideUp(200);
					$('#unamereg').val("");
					$('#pwdreg').val("");
					$('#headertext').html("<a href='#' onclick='now.tryLogout()'>Logout</a>");
					
					//set cookie here
					$.cookie('username', uname);
					$.cookie('pwd', pwd);
					now.setCookie(uname, pwd);
				}
				
				now.nullCookie = function () {
					$.cookie('username', "");
					$.cookie('pwd', "");
				}
				
				//puts back the Register | Signin stuff
				now.finishLogout = function() {
					$('#headertext').html('<a href="#" onclick="displaySignIn();">Sign In</a> - <a href="#" onclick="displayRegister();">Register</a>');
					$.cookie('username', null, {expires: -1});
					$.cookie('pwd', null, {expires: -1});
				}
				
				hideDivs = function() {
					$('#logindiv').hide();
					$('#registerdiv').hide();
				}
				
				displaySignIn = function() {
					$('#registerdiv').slideUp(200);
					setTimeout(function () {
						$('#logindiv').slideToggle(200);
					}, 200);
				}
				displayRegister = function() {
					$('#logindiv').slideUp(200);
					setTimeout(function () {
						$('#registerdiv').slideToggle(200);
					}, 200);
				}
				
				now.ready(function() {
					hideDivs();
				});
				
				$('form > input').keypress(function (e) {
					if (e.keyCode == 13) {
						$(this).siblings().last().click();
					}
				});
			});
		</script>
	</head>
	<body>
		<div id="bodywrapper">
			<div id="header">
				<div id="logo">Soncoya</div>
				<div id="headertext">
					<a href="#" onclick="displaySignIn();">Sign In</a> - <a href="#" onclick="displayRegister();">Register</a>
				</div>
			</div>
			
			<div id="logindiv">
				<form name="loginform" action="/login" method="post">
					Username 
					<br><input type="text" id="unamelogin" name="unamelogin" placeholder="Twilight Sparkle"/><br>
					Password
					<br><input type="password" id="pwdlogin" name="pwdlogin" />
					<br><input type="button" id="loginsubmit" value="Login!"/>
				</form>
			</div>
			
			<div id="registerdiv">
				<form name="registerform" action="/register" method="post">
					Username
					<br><input type="text" id="unamereg" name="uname" placeholder="Rainbow Dash"/></br>
					Password
					<br><input type="password" id="pwdreg" name="pwd"/>
					<br><input type="button" id="registersubmit" value="Register!"/>
				</form>
			</div>
			
			
			<input type="button" id="exampleRecipe" value="RECIPE 1!"/>
			<input type="button" id="exampleRecipe1" value="RECIPE 2!"/>
			<input type="button" id="refreshRecipeList" value="REFRESH!"/>
			<input type="button" id="refreshRecipeListT" value="REFRESH TOMATO!"/>
			<input type="button" id="refreshRecipeListP" value="REFRESH POTATO!"/>
			<input type="button" id="prevpage" value="Previous Page">
			<input type="button" id="nextpage" value="Next Page">
			<div id="currentpage">1</div>
			
			<br>
			<input type="text" id="filter" value="" />
			
			
			<div id="recipelistdiv">
			</div>
		</div>
	</body>
